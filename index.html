<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥å¿«ä¹å°æ¸¸æˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background: #ffe6e6;
        }
        #game-container {
            margin: 20px auto;
            max-width: 800px;
        }
        canvas {
            border: 1px solid #000;
            background: #f7f7f7;
        }
        .button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #ff6f61;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #ff3d2f;
        }
        #message-section {
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>ğŸ‚ ä»Šå¤©æ˜¯æˆ‘çš„ç”Ÿæ—¥ï¼å¸®æˆ‘åšè›‹ç³•å§ï¼ğŸ‚</h1>
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <button id="nextLevelButton" class="button" style="display:none;">è¿›å…¥ä¸‹ä¸€å…³</button>
    </div>
    <div id="message-section">
        <h2>ğŸ‰ æ­å–œä½ å®Œæˆè›‹ç³•åˆ¶ä½œï¼ğŸ‰</h2>
        <p>ä½ æƒ³å¯¹æˆ‘è¯´äº›ä»€ä¹ˆï¼Ÿ</p>
        <textarea id="messageInput" rows="4" cols="50" placeholder="å†™ä¸‹ä½ çš„ç¥ç¦å§..."></textarea><br>
        <button class="button" id="sendMessageButton">å‘é€ç•™è¨€</button>
        <p id="successMessage" style="color: green; display: none;">ğŸ‰ ç•™è¨€æˆåŠŸï¼è°¢è°¢ä½ çš„ç¥ç¦ï¼ğŸ‰</p>
    </div>
    <script>
        let level = 1;
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const nextLevelButton = document.getElementById('nextLevelButton');
        const messageSection = document.getElementById('message-section');
        const messageInput = document.getElementById('messageInput');
        const sendMessageButton = document.getElementById('sendMessageButton');
        const successMessage = document.getElementById('successMessage');

        const images = {};
        const loadImages = (srcs, callback) => {
            let loaded = 0;
            const keys = Object.keys(srcs);
            keys.forEach((key) => {
                images[key] = new Image();
                images[key].src = srcs[key];
                images[key].onload = () => {
                    loaded++;
                    if (loaded === keys.length) callback();
                };
            });
        };

        const srcs = {
            egg: 'egg.png',
            basket: 'basket.png',
            bowl: 'bowl.png',
            whisk: 'whisk.png',
            oven: 'oven.png',
            cream: 'cream.png',
            cake1: 'cake1.png',
            cake2: 'cake2.png',
            cake3: 'cake3.png',
            cake4: 'cake4.png',
        };

        function startLevel1() {
            let basketX = canvas.width / 2 - 50;
            const basketWidth = 100;
            const basketHeight = 90;
            // é¸¡è›‹çš„åˆå§‹ä½ç½®å’Œå±æ€§
            const egg = {
                x: Math.random() * canvas.width, // é¸¡è›‹æ°´å¹³åˆå§‹ä½ç½®
                y: 0, // é¸¡è›‹åˆå§‹çºµå‘ä½ç½®
                width: 40, // é¸¡è›‹å®½åº¦ï¼ˆæ¤­åœ†çš„æ¨ªè½´ï¼‰
                height: 60, // é¸¡è›‹é«˜åº¦ï¼ˆæ¤­åœ†çš„çºµè½´ï¼‰
                speed: 2 // é¸¡è›‹ä¸‹è½é€Ÿåº¦
            };
            let isEggCaught = false;

            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                basketX = e.clientX - rect.left - basketWidth / 2;
            });

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶æ¤­åœ†é¸¡è›‹
                ctx.drawImage(
                    images.egg, 
                    egg.x - egg.width / 2, 
                    egg.y - egg.height / 2, 
                    egg.width, 
                    egg.height
                );
                // ç»˜åˆ¶ç¯®å­
                ctx.drawImage(images.basket, basketX, canvas.height - basketHeight - 10, basketWidth, basketHeight);

                if (!isEggCaught) egg.y += egg.speed;

                if (
                    egg.y + egg.height / 2 >= canvas.height - basketHeight + basketWidth/2 && // é¸¡è›‹çš„åº•éƒ¨åˆ°è¾¾ç¯®å­é«˜åº¦
                    egg.x >= basketX && // é¸¡è›‹çš„ä¸­å¿ƒåœ¨ç¯®å­å·¦è¾¹ç•Œä¹‹å†…
                    egg.x <= basketX + basketWidth // é¸¡è›‹çš„ä¸­å¿ƒåœ¨ç¯®å­å³è¾¹ç•Œä¹‹å†…
                ) {
                    isEggCaught = true;
                    nextLevelButton.style.display = 'block';
                }

                if (!isEggCaught) requestAnimationFrame(draw);
            }

            draw();
        }

        function startLevel2() {
            let stirCount = 0; // æ…æ‹Œæ¬¡æ•°
            const circleCenter = { x: canvas.width / 2, y: canvas.height / 2 }; // åœ†å¿ƒä½ç½®
            const radius = 160; // æ…æ‹ŒåŒºåŸŸåŠå¾„
            const startTime = Date.now(); // æ¸¸æˆå¼€å§‹æ—¶é—´
            const maxTime = 10000; // æœ€å¤§æ—¶é—´ï¼ˆ10ç§’ï¼‰
            const targetStirCount = 200; // ç›®æ ‡æ…æ‹Œæ¬¡æ•°
            const creamLayers = []; // å­˜å‚¨å¥¶æ²¹å±‚ä½ç½®

            // å®šä¹‰æ…æ‹Œå·¥å…·çš„ä½ç½®
            let whiskPosition = { x: circleCenter.x, y: circleCenter.y };

            // æ·»åŠ é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç›‘å¬å™¨
            canvas.addEventListener('mousemove', stir);

            // æ…æ‹Œé€»è¾‘
            function stir(e) {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left; // é¼ æ ‡ç›¸å¯¹äºç”»å¸ƒçš„ x åæ ‡
                const mouseY = e.clientY - rect.top; // é¼ æ ‡ç›¸å¯¹äºç”»å¸ƒçš„ y åæ ‡

                // è®¡ç®—é¼ æ ‡ç›¸å¯¹åœ†å¿ƒçš„ä½ç§»
                const dx = mouseX - circleCenter.x;
                const dy = mouseY - circleCenter.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // é™åˆ¶æ…æ‹Œå·¥å…·åœ¨ç¢—çš„èŒƒå›´å†…
                if (distance < radius) {
                    whiskPosition.x = mouseX;
                    whiskPosition.y = mouseY;
                } else {
                    const angle = Math.atan2(dy, dx); // è®¡ç®—è§’åº¦
                    whiskPosition.x = circleCenter.x + radius * Math.cos(angle); // é™åˆ¶åœ¨è¾¹ç•Œ
                    whiskPosition.y = circleCenter.y + radius * Math.sin(angle);
                }

                // åœ¨ç¢—å†…ç”Ÿæˆå¥¶æ²¹å±‚
                if (distance < radius-30) {
                    stirCount++;
                    creamLayers.push({
                        x: whiskPosition.x + Math.random() * 10 - 5,
                        y: whiskPosition.y + Math.random() * 10 - 5,
                    });

                    // è¾¾åˆ°æ…æ‹Œç›®æ ‡æ¬¡æ•°
                    if (stirCount >= targetStirCount) {
                        nextLevelButton.style.display = 'block'; // æ˜¾ç¤ºâ€œä¸‹ä¸€å…³â€æŒ‰é’®
                        canvas.removeEventListener('mousemove', stir); // ç§»é™¤äº‹ä»¶ç›‘å¬
                    }
                }
            }

            // ç»˜åˆ¶æ¸¸æˆç”»é¢
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height); // æ¸…ç©ºç”»å¸ƒ

                // ç»˜åˆ¶æ…æ‹Œç¢—
                ctx.drawImage(images.bowl, circleCenter.x - radius, circleCenter.y - radius, radius * 2, radius * 2);

                // ç»˜åˆ¶å¥¶æ²¹å±‚
                creamLayers.forEach((layer) => {
                    ctx.drawImage(images.cream, layer.x - 10, layer.y - 10, 40, 40);
                });

                // ç»˜åˆ¶æ…æ‹Œå·¥å…·
                ctx.drawImage(images.whisk, whiskPosition.x - 30, whiskPosition.y - 30, 100, 100);

                // æ£€æŸ¥æ—¶é—´å’Œæ…æ‹Œæ¬¡æ•°
                if (Date.now() - startTime < maxTime) {
                    if (stirCount < targetStirCount) {
                        requestAnimationFrame(draw); // ç»§ç»­ç»˜åˆ¶
                    } else {
                        console.log("æ…æ‹Œå®Œæˆï¼");
                    }
                } else {
                    // æ—¶é—´åˆ°ä¸”ç›®æ ‡æœªå®Œæˆï¼Œé‡ç½®æ¸¸æˆ
                    console.log("æ—¶é—´åˆ°ï¼Œé‡æ–°å¼€å§‹æ…æ‹Œï¼");
                    resetGame();
                }
            }

            // é‡ç½®æ¸¸æˆé€»è¾‘
            function resetGame() {
                stirCount = 0; // é‡ç½®æ…æ‹Œæ¬¡æ•°
                creamLayers.length = 0; // æ¸…ç©ºå¥¶æ²¹å±‚
                whiskPosition = { x: circleCenter.x, y: circleCenter.y }; // é‡ç½®æ…æ‹Œå·¥å…·ä½ç½®
                // é‡æ–°æ·»åŠ é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç›‘å¬å™¨
                canvas.addEventListener('mousemove', stir);
                draw(); // é‡æ–°å¼€å§‹ç»˜åˆ¶
            }

            draw(); // å¼€å§‹ç»˜åˆ¶æ¸¸æˆ
        }

        function startLevel3() {
    
            const redZoneStart = 150; // çº¢è‰²åŒºåŸŸèµ·å§‹ä½ç½®
            const redZoneEnd = 250;  // çº¢è‰²åŒºåŸŸç»“æŸä½ç½®
            const progressBarWidth = 400; // è¿›åº¦æ¡æ€»å®½åº¦
            const progressBarHeight = 20; // è¿›åº¦æ¡é«˜åº¦
            const progressBarX = 100; // è¿›åº¦æ¡Xä½ç½®
            const progressBarY = 350; // è¿›åº¦æ¡Yä½ç½®

            let pointX = progressBarX; // ç‚¹çš„åˆå§‹ä½ç½®
            let pointDirection = 1; // ç‚¹çš„ç§»åŠ¨æ–¹å‘ï¼Œ1ä¸ºå³ï¼Œ-1ä¸ºå·¦
            let isSuccess = false; // æ˜¯å¦æˆåŠŸç‚¹å‡»
            let isCakeBaking = false; // æ˜¯å¦æ­£åœ¨çƒ¤è›‹ç³•
            let bakeStartTime = 0; // çƒ¤è›‹ç³•å¼€å§‹æ—¶é—´
            const selectedCake = ['cake1', 'cake2', 'cake3', 'cake4'][Math.floor(Math.random() * 4)]; // éšæœºè›‹ç³•

            canvas.addEventListener('click', () => {
                // æ£€æŸ¥ç‚¹å‡»æ˜¯å¦æˆåŠŸ
                if (pointX >= redZoneStart && pointX <= redZoneEnd && !isSuccess) {
                    isSuccess = true;
                    bakeStartTime = Date.now(); // å¼€å§‹è®¡æ—¶
                    isCakeBaking = true;
                }
            });

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶çƒ¤ç®±
                ctx.drawImage(images.oven, 50, 50, 500, 300);

                // ç»˜åˆ¶è¿›åº¦æ¡èƒŒæ™¯ï¼ˆæ¸å˜é¢œè‰²ï¼‰
                const gradient = ctx.createLinearGradient(
                    progressBarX,
                    progressBarY,
                    progressBarX + progressBarWidth,
                    progressBarY
                );
                gradient.addColorStop(0, 'blue');
                gradient.addColorStop(0.5, 'red');
                gradient.addColorStop(1, 'blue');
                ctx.fillStyle = gradient;
                ctx.fillRect(progressBarX, progressBarY, progressBarWidth, progressBarHeight);

                // ç»˜åˆ¶çº¢è‰²ç›®æ ‡åŒºåŸŸçš„è¾¹æ¡†
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.strokeRect(redZoneStart, progressBarY, redZoneEnd - redZoneStart, progressBarHeight);

                // ç»˜åˆ¶ç§»åŠ¨çš„ç‚¹
                if (!isSuccess) {
                    ctx.fillStyle = 'yellow';
                    ctx.beginPath();
                    ctx.arc(pointX, progressBarY + progressBarHeight / 2, 10, 0, Math.PI * 2);
                    ctx.fill();

                    // æ›´æ–°ç‚¹çš„ä½ç½®
                    pointX += pointDirection * 3; // æ¯å¸§ç§»åŠ¨ 3 åƒç´ 
                    if (pointX >= progressBarX + progressBarWidth || pointX <= progressBarX) {
                        pointDirection *= -1; // åå‘ç§»åŠ¨
                    }
                }

                // æˆåŠŸåç»˜åˆ¶çƒ¤è›‹ç³•
                if (isSuccess && isCakeBaking) {
                    ctx.fillStyle = 'white';
                    ctx.font = '20px Arial';
                    ctx.fillText('Baking in progress...', 200, 300);

                    if (Date.now() - bakeStartTime >= 5000) {
                        isCakeBaking = false;
                        ctx.drawImage(images[selectedCake], 200, 200, 200, 200); // æ˜¾ç¤ºæœ€ç»ˆè›‹ç³•
                        nextLevelButton.style.display = 'block'; // æ˜¾ç¤ºâ€œä¸‹ä¸€å…³â€æŒ‰é’®
                    }
                }

                if (!isSuccess || isCakeBaking) {
                    requestAnimationFrame(draw); // åŠ¨ç”»å¾ªç¯
                }
            }

            draw();
        }

        function startGame() {
            if (level === 1) startLevel1();
            else if (level === 2) startLevel2();
            else if (level === 3) startLevel3();
        }

        nextLevelButton.addEventListener('click', () => {
            level++;
            nextLevelButton.style.display = 'none';

            if (level > 3) {
                canvas.style.display = 'none';
                messageSection.style.display = 'block';
            } else {
                startGame();
            }
        });

        sendMessageButton.addEventListener('click', () => {
            if (messageInput.value.trim()) {
                successMessage.style.display = 'block';
            }
        });

        loadImages(srcs, startGame);
    </script>
</body>
</html>
